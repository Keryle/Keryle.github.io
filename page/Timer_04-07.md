---
layout: default
title: Timer
description: 定时器的使用
---

## 控制树

TOMD——>TH/TL——>TR——>TX1/TX0——>EA——>中断  

EA，TX,TMOD一般写入主函数，在程序中首先配置好，不经常改变。TH/TL，TR会写入中断函数中，每次重新赋予初始值。分层控制结构虽然琐碎，却也巧妙，提供了灵活的操作空间。

## IE、IP

EA是总中断开关，置1开启。ET定时器控制开关置1开启，PT置1为高优先级。

## TMOD

| 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
| - | - | - | - | - | - | - | - |
|GATE | C/T | M1 | M0 | GATE | C/T | M1 | M0 |

T0/T1模式选择：

* 不可位寻址，复位值：00H，高四位控制T1，低四位控制T0
* GATE：门控位，当GATE=1，需要INT0/INT1引脚置1才可开启定时计数器
* C/T：置1为计数器，置0为计数器
* M1、M0：定时器/计数器模式选择
    1. 0 0：13位定时器/计数器，2^13=8192，定时最大值8.19ms
    2. 0 1：16位定时器/计数器，2^16=65536 ，定时最大值65.5ms
    3. 1 0：8位自动重装载定时器，2^8=256，定时最大值0.256ms
    4. 1 1：T1无效，定时器0此时作为双8位定时器/计数器。
            TL0作为一个8位定时器/计数器，通过标准定时器0的控制位控制。
            TH0仅作为一个 8位定时器,由定时器1的控制位控制。

## TH、TL

T0的初始值TH0,TL0. T1的初始值TH1,TL1。在模式0或1时，需要进入中断后程序赋初值，在模式2或3时，自动重装载初始值。

## TCON

定时器/计数器控制寄存器。它的的低4位控制外部中断，高4位中软件能操作只有TR0,TR1，他们分别控制T0和T1，当TR0/TR1=1时，定时计数器启动，开始工作。定时器开始工作时，**无法给TH,TL赋值**，只有当TR0/TR1=0时才能赋值。TR置位一般是启动定时器的最后一步。
